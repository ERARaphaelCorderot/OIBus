"use strict";(self.webpackChunkdoc_oibus=self.webpackChunkdoc_oibus||[]).push([[3066],{1050:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var s=i(4848),r=i(8453);const o={displayed_sidebar:"developerSidebar",sidebar_position:4},c="OIBus with Docker",t={id:"developer/docker",title:"OIBus with Docker",description:"OIBus can be incorporated into a Docker image.",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/developer/docker.md",sourceDirName:"developer",slug:"/developer/docker",permalink:"/zh/docs/developer/docker",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{displayed_sidebar:"developerSidebar",sidebar_position:4},sidebar:"developerSidebar",previous:{title:"Connector class",permalink:"/zh/docs/developer/create-connector/class"}},d={},a=[{value:"Docker image",id:"docker-image",level:2},{value:"Dependencies",id:"dependencies",level:3},{value:"Dockerfile",id:"dockerfile",level:3},{value:"Docker commands",id:"docker-commands",level:3},{value:"Specifics settings in Docker",id:"specifics-settings-in-docker",level:2},{value:"Web server port",id:"web-server-port",level:3},{value:"IP filters",id:"ip-filters",level:3},{value:"Curl command",id:"curl-command",level:4},{value:"Bash script",id:"bash-script",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"oibus-with-docker",children:"OIBus with Docker"}),"\n",(0,s.jsx)(n.p,{children:"OIBus can be incorporated into a Docker image."}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsx)(n.p,{children:"This section is currently under development, and OIBus docker images will be made accessible shortly."})}),"\n",(0,s.jsx)(n.h2,{id:"docker-image",children:"Docker image"}),"\n",(0,s.jsx)(n.p,{children:"The image below takes two parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"arch (default: x64)"}),"\n",(0,s.jsx)(n.li,{children:"version"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This enables the creation of a Docker image with a particular OIBus version and architecture."}),"\n",(0,s.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,s.jsxs)(n.p,{children:["This image requires an ",(0,s.jsx)(n.code,{children:"oibus-init.sh"})," script for sending ",(0,s.jsx)(n.em,{children:"curl"})," commands to OIBus endpoints. If you don't want to include\nthis file, you will need to run a ",(0,s.jsx)(n.a,{href:"#curl-command",children:"curl command"})," from inside the docker."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="oibus-init.sh"',children:'#!/bin/bash\n\ncurl --location --request POST \'http://localhost:2223/api/ip-filters\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "address": "*",\n    "description": "All"\n}\' \\\n-u "admin:pass"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-docker",metastring:'title="Dockerfile"',children:'FROM ubuntu\n\nARG arch="x64"\nARG version="v3.0.4"\n\n# Install git\nRUN apt update -y && apt install -y curl unzip\n\n# Create app directory\nWORKDIR /app\n\nRUN curl -LO https://github.com/OptimistikSAS/OIBus/releases/download/${version}/oibus-linux_${arch}-${version}.zip\nRUN unzip -a oibus-linux_${arch}-${version}.zip -d OIBus/\nWORKDIR /app/OIBus\nCOPY ./oibus-init.sh .\nRUN mkdir OIBusData\n\n# Expose port 2223 for OIBus\nEXPOSE 2223\n\n# Start OIBus\nCMD ["./oibus", "--config", "./OIBusData"]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"docker-commands",children:"Docker commands"}),"\n",(0,s.jsxs)(n.p,{children:["Build the docker image:\n",(0,s.jsx)(n.code,{children:"docker build -t oibus ."})]}),"\n",(0,s.jsxs)(n.p,{children:["Build the docker image with specific architecture and version:\n",(0,s.jsx)(n.code,{children:'docker build -t oibus --build-arg arch="arm64" --build-arg version="v3.0.4" .'})]}),"\n",(0,s.jsxs)(n.p,{children:["Run a container:\n",(0,s.jsx)(n.code,{children:"docker run --name oibus -d -p 2223:2223 -v ./OIBusData:/app/OIBus/OIBusData oibus"})]}),"\n",(0,s.jsx)(n.p,{children:"The volume is not mandatory, but can be useful to access cache, logs, configuration database..."}),"\n",(0,s.jsx)(n.h2,{id:"specifics-settings-in-docker",children:"Specifics settings in Docker"}),"\n",(0,s.jsx)(n.h3,{id:"web-server-port",children:"Web server port"}),"\n",(0,s.jsxs)(n.p,{children:["When using OIBus within a container, the default HTTP port 2223 is exposed. If you wish to access OIBus from a different\nport, you can modify the ",(0,s.jsx)(n.a,{href:"#docker-commands",children:"docker run"})," command accordingly."]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsx)(n.p,{children:"Do not change the HTTP port from the OIBus configuration. You will not be able to access the web page again if you\nchange it."})}),"\n",(0,s.jsx)(n.h3,{id:"ip-filters",children:"IP filters"}),"\n",(0,s.jsxs)(n.p,{children:["By default, OIBus accepts connections only from localhost by ",(0,s.jsx)(n.a,{href:"/zh/docs/guide/engine/ip-filters",children:"filtering IP"}),". When inside\na docker, the IP filter list must be updated."]}),"\n",(0,s.jsx)(n.p,{children:"You can either use the curl command or the bash script."}),"\n",(0,s.jsx)(n.h4,{id:"curl-command",children:"Curl command"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'docker exec -it oibus curl --location --request POST \'http://localhost:2223/api/ip-filters\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n    "address": "*",\n    "description": "All"\n}\' \\\n-u "admin:pass"\n\n'})}),"\n",(0,s.jsx)(n.h4,{id:"bash-script",children:"Bash script"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"docker exec -it oibus ./oibus-init.sh"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>t});var s=i(6540);const r={},o=s.createContext(r);function c(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);