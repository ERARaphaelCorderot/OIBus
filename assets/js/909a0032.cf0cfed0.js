"use strict";(self.webpackChunkdoc_oibus=self.webpackChunkdoc_oibus||[]).push([[1005],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=i.createContext({}),l=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return i.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=r,h=p["".concat(c,".").concat(m)]||p[m]||d[m]||a;return n?i.createElement(h,o(o({ref:t},u),{},{components:n})):i.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:r,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=n(7462),r=(n(7294),n(3905));const a={sidebar_position:2},o="OPCUA",s={unversionedId:"guide/south-connectors/opcua",id:"guide/south-connectors/opcua",title:"OPCUA",description:"OPCUA, which stands for OPC Unified Architecture, is a protocol designed for accessing data in both read and write modes.",source:"@site/docs/guide/south-connectors/opcua.md",sourceDirName:"guide/south-connectors",slug:"/guide/south-connectors/opcua",permalink:"/docs/guide/south-connectors/opcua",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"guideSidebar",previous:{title:"Folder Scanner",permalink:"/docs/guide/south-connectors/folder-scanner"},next:{title:"Microsoft SQL Server (MSSQL)",permalink:"/docs/guide/south-connectors/mssql"}},c={},l=[{value:"Specific settings",id:"specific-settings",level:2},{value:"Item settings",id:"item-settings",level:2},{value:"Security settings",id:"security-settings",level:2},{value:"Communication",id:"communication",level:3},{value:"Authentication",id:"authentication",level:3},{value:"Use the same certificate for user authentication and secure communications",id:"use-the-same-certificate-for-user-authentication-and-secure-communications",level:3},{value:"Using certificates with ProSys OPC UA Simulation Server",id:"using-certificates-with-prosys-opc-ua-simulation-server",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"opcua"},"OPCUA"),(0,r.kt)("p",null,"OPCUA, which stands for OPC Unified Architecture, is a protocol designed for accessing data in both read and write modes.\nThe data is organized within a tree-like address space and is referenced using unique identifiers known as node IDs.\nOPCUA is a modern standard that is based on TCP/IP and has replaced older OPC HDA/DA technologies (refer to the\n",(0,r.kt)("a",{parentName:"p",href:"/docs/guide/south-connectors/opchda"},"OPCHDA connector"),"). It is often natively embedded in industrial controllers."),(0,r.kt)("p",null,"OPCUA incorporates two variants of the protocol: HA (Historical Access) and DA (Data Access). In HA mode, you can access\na history of values over a specified time interval for the requested data points, whereas in DA mode, you can access the\nvalues at each request or listen to changes in the values."),(0,r.kt)("p",null,"OIBus integrates both OPCUA modes (HA and DA) in read-only mode, using the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/node-opcua/node-opcua"},"node-opcua library"),"."),(0,r.kt)("h2",{id:"specific-settings"},"Specific settings"),(0,r.kt)("p",null,"To establish a connection to an OPCUA server, OIBus requires several settings:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"URL"),": This is the string used to connect to the server, and it follows the format ",(0,r.kt)("inlineCode",{parentName:"li"},"opc.tcp://<host>:<port>/<server-name>"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Retry interval")," : The time to wait between reconnection attempts in the event of a connection failure."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Security Mode")," : Communication can be secured using the security mode and security policy fields. Available security\nmodes include: ",(0,r.kt)("em",{parentName:"li"},"None"),", ",(0,r.kt)("em",{parentName:"li"},"Sign"),", ",(0,r.kt)("em",{parentName:"li"},"SignAndEncrypt"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Security Policy")," (Applicable when Security mode is not None): Security policies define the level of security for communication.\nAvailable security policies include: None, Basic128, Basic192, Basic256, Basic128Rsa15, Basic192Rsa15, Basic256Rsa15,\nBasic256Sha256, Aes128_Sha256_RsaOaep, PubSub_Aes128_CTR, PubSub_Aes256_CTR."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Authentication"),": Authentication options include None, Basic, and Certificate. Refer to the ",(0,r.kt)("a",{parentName:"li",href:"#authentication"},"security settings"),"\nfor more details.")),(0,r.kt)("admonition",{title:"Compatibility with the OPCUA server",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"It's essential to choose a security mode and security policy that are supported by the OPCUA server you are connecting to.\nEnsuring compatibility is crucial for a successful connection.")),(0,r.kt)("h2",{id:"item-settings"},"Item settings"),(0,r.kt)("p",null,"When configuring each item to retrieve data in JSON payload, you'll need to specify the following specific settings:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Node ID"),": The Node ID corresponds to the path of the data within the appropriate namespace on the OPCUA server.\nIt's essential to consider the supported node format of the server, which may use either numbers or strings. For example,\non Prosys, ",(0,r.kt)("inlineCode",{parentName:"li"},"ns=3;i=1001")," matches ",(0,r.kt)("inlineCode",{parentName:"li"},"ns=3;s=Counter"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Mode"),": You can select either HA (Historical Access) or DA (Data Access) mode, depending on your requirements."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Aggregate")," (HA mode only): In HA mode, there is an option to aggregate the retrieved values over the requested interval."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Resampling")," (HA mode only): Similarly, in HA mode, you can choose to resample the retrieved values at the requested\ninterval.")),(0,r.kt)("admonition",{title:"Compatibility with the OPCUA server",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"It's important to note that not all aggregation and resampling options are supported by OPCUA servers. To avoid\ncompatibility issues, it's recommended to use ",(0,r.kt)("inlineCode",{parentName:"p"},"Raw")," aggregation and ",(0,r.kt)("inlineCode",{parentName:"p"},"None")," resampling whenever possible. Additionally,\nensure that the selected mode (HA or DA) is supported by the server you are connecting to.")),(0,r.kt)("p",null,"The name of the item will serve as a reference in JSON payloads, specifically in the ",(0,r.kt)("inlineCode",{parentName:"p"},"pointID")," field for the North application. "),(0,r.kt)("h2",{id:"security-settings"},"Security settings"),(0,r.kt)("h3",{id:"communication"},"Communication"),(0,r.kt)("p",null,"When using a security mode other than ",(0,r.kt)("em",{parentName:"p"},"None"),", a certificate is required to sign and potentially encrypt the communications.\nOIBus generates a self-signed certificate for securing communication with the OPCUA server during startup. You can locate\nthe certificate used by OPCUA in the ",(0,r.kt)("inlineCode",{parentName:"p"},"opcua")," folder of the South cache. This certificate must be trusted by the OPCUA\nserver to enable secure communication."),(0,r.kt)("admonition",{title:"Example on Prosys OPCUA Simulation Server",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("img",{alt:"Prosys OPCUA Simulation Server Certificates",src:n(1172).Z,width:"995",height:"627"}),"\nIf the certificate is not trusted by the OPCUA server, you may encounter an error with the message: ",(0,r.kt)("inlineCode",{parentName:"p"},"Error: The connection \nmay have been rejected by the server"),".")),(0,r.kt)("h3",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"The certificate used for client authentication must be added to the trusted user certificates list on the OPCUA server.\nIt is managed separately from the self-signed certificate mentioned earlier, which is used for\n",(0,r.kt)("a",{parentName:"p",href:"#communication"},"securing communication"),"."),(0,r.kt)("admonition",{title:"Example on Prosys OPCUA Simulation Server",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For Prosys OPC UA servers, the certificate used to authenticate OIBus must be placed in the\n",(0,r.kt)("inlineCode",{parentName:"p"},".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs")," folder. Failure to do so may result in an error with the\nmessage: ",(0,r.kt)("inlineCode",{parentName:"p"},"Error: serviceResult = BadIdentityTokenRejected (0x80210000)"),"."),(0,r.kt)("p",{parentName:"admonition"},"If a connection has previously been attempted and rejected, you should remove the certificate from the ",(0,r.kt)("strong",{parentName:"p"},"rejected certificates"),"\nfolder (",(0,r.kt)("inlineCode",{parentName:"p"},".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\rejected"),") and move it to the ",(0,r.kt)("strong",{parentName:"p"},"trusted")," folder\n(",(0,r.kt)("inlineCode",{parentName:"p"},".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"),").")),(0,r.kt)("h3",{id:"use-the-same-certificate-for-user-authentication-and-secure-communications"},"Use the same certificate for user authentication and secure communications"),(0,r.kt)("p",null,"The same certificate can be used for both sign and encrypt operations and for authentication. To do that, the ",(0,r.kt)("inlineCode",{parentName:"p"},"cert.pem"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"private.pem")," file paths must be specified. They are located in the south cache data stream folder (inside the opcua\ndirectory)."),(0,r.kt)("p",null,"On the OPCUA server side, the self-signed certificate (",(0,r.kt)("inlineCode",{parentName:"p"},"cert.pem"),") must be copied in the user certificates' folder."),(0,r.kt)("p",null,"For example, with Prosys OPCUA Simulation Server: ",(0,r.kt)("inlineCode",{parentName:"p"},".prosysopc\\prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"),"."),(0,r.kt)("h2",{id:"using-certificates-with-prosys-opc-ua-simulation-server"},"Using certificates with ProSys OPC UA Simulation Server"),(0,r.kt)("p",null,"You can create your self-signed certificate to authenticate OIBus with the ",(0,r.kt)("strong",{parentName:"p"},"Cert")," method."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a cert.conf file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[ req ]\ndefault_bits = 2048\ndefault_md = sha256\ndistinguished_name = subject\nreq_extensions = req_ext\nx509_extensions = req_ext\nstring_mask = utf8only\nprompt = no\n\n[ req_ext ]\nbasicConstraints = CA:FALSE\nnsCertType = client, server\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment, dataEncipherment, keyCertSign\nextendedKeyUsage= serverAuth, clientAuth\nnsComment = "OIBus User Cert"\nsubjectKeyIdentifier=hash\nauthorityKeyIdentifier=keyid,issuer\nsubjectAltName = URI:urn:opcua:user:oibus,IP: 127.0.0.1\n\n[ subject ]\ncountryName = FR\nstateOrProvinceName = FR\nlocalityName = Chamb\xe9ry\norganizationName = OI\ncommonName = oibus\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Create a private key and certificate using the ",(0,r.kt)("inlineCode",{parentName:"li"},"cert.conf"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"openssl req -new -x509 -keyout oibus.key -out oibus.pem -config cert.conf\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Remove private key passphrase:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"openssl rsa -in oibus.key -out oibus.key\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Create DER cert for ProSys:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"openssl x509 -inform PEM -outform DER -in oibus.pem -out oibus.der\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Copy the DER cert in ProSys USERS_PKI certificate folder: ",(0,r.kt)("inlineCode",{parentName:"li"},"prosys-opc-ua-simulation-server\\USERS_PKI\\CA\\certs"))))}d.isMDXComponent=!0},1172:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/prosys-opcua-simulation-server-certificates-3aa9f72ae5a03d39b377b01e927c54ba.png"}}]);